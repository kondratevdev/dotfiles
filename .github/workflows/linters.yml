name: Linters Checks

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  linters:
    name: Linters Checks
    runs-on: ubuntu-latest
    if: github.actor != 'dependabot[bot]'  # Skip for Dependabot
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ShellCheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Run ShellCheck
        run: |
          # Find all `.sh` files:
          sh_files=$(find . -type f -name "*.sh")

          # Adding files from `shell` folder:
          shell_folder=$(find shell -type f 2>/dev/null || echo "")

          # Adding files from `config` folder:
          config_folder=$(find config -type f \( -name "bashrc" -o -name "bash_profile" \) 2>/dev/null || echo "")

          # Merge:
          all_files="$sh_files $shell_folder"

          # Check
          if [ -z "$all_files" ]; then
            echo "No shell scripts found."
          else
            echo "Running ShellCheck on the following files:"
            echo "$all_files"
            shellcheck -s bash $all_files
          fi

      - name: Run Zsh check
        shell: zsh {0}
        run: |
          for file in config/zshrc config/zplugrc; do
            if [ -f "$file" ]; then
              echo "Checking $file with zsh -n"
              zsh -n "$file"
            fi
          done

      - name: Run Git config check
        run: |
          for file in config/gitconfig config/gitattributes config/gitignore; do
            if [ -f "$file" ]; then
              echo "Checking $file with git"
              git config --list --file "$file"
            fi
          done

      - name: Install EditorConfig Checker
        run: |
          sudo apt-get install -y npm
          npm install -g editorconfig-checker

      - name: Run EditorConfig validation
        run: |
          if [ -f config/editorconfig ]; then
            echo "Checking config/editorconfig"
            editorconfig-checker
          fi

      - name: Hyper.js syntax check
        run: |
          if [ -f config/hyper.js ]; then
            echo "Checking config/hyper.js with Node"
            node -c config/hyper.js
          fi
